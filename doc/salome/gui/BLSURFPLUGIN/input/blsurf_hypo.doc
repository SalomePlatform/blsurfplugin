/*!

\page blsurf_hypo_page MG-CADSurf Parameters hypothesis

\anchor blsurf_top

\tableofcontents

\section blsurf_general_parameters General parameters

\image html blsurf_parameters.png

- <b>Name</b> - allows defining the name of the hypothesis (MG-CADSurf
Parameters_n by default).

- <b>Physical Mesh</b> - can be set to <em>None</em>, <em>Global size</em>
  or <em>Local size</em>

  - if set to <em>Global size</em>, only the <b>User size</b>,
  <b>Max Size</b> and <b>Min Size</b> fields are taken into account.

  - if set to <em>Local size</em>, behaves like <em>Custom</em> mode and takes into
  account the "Gradation" parameter and the custom elements sizes given in the
  "Local size" tab.

- <b>Geometrical mesh</b> - can be set to <em>None</em>, <em>Global size</em>

  - if set to <em>Global size</em>, allows user input in <b>Mesh angle</b>,
  <b>Mesh distance</b> and <b>Gradation</b> fields. These fields control
  computation of the element size, so called <i>geometrical size</i>, conform
  to the surface geometry considering local curvatures. If both the <b>User size</b>
  and the <i>geometrical parameters</i> are defined, the  eventual element size
  corresponds to the least of the two.

- <b>User size</b> - defines the size of the generated mesh elements. If "Relative value"
is checked, the value is relative to the diagonal of the shape.

- <b>Max Size</b> - defines the upper limit of mesh element size. If "Relative value"
is checked, the value is relative to the diagonal of the shape.

- <b>Min Size</b> - defines the lower limit of mesh element size. If "Relative value"
is checked, the value is relative to the diagonal of the shape.

- <b>Gradation</b> - maximum ratio between the lengths of two adjacent edges.

- <b>Quadratic mesh</b> - if checked, quadratic elements will be generated.

- <b>Mesh angle</b> - Limiting angle (in degree) between the plane of a triangle of the mesh and each of the tangent planes at the three vertices.
The smaller this angle is, the closer the mesh is to the exact surface, and the denser the resulting mesh is.

- <b>Mesh distance</b> - Maximum desired distance between a triangle and its supporting CAD surface.
The smaller this distance is, the closer the mesh is to the exact surface (only available in isotropic meshing).

- <b>Anisotropic</b> - if checked, this parameter defines the maximum anisotropic ratio of the metric governing the anisotropic meshing process.
The default value (0) means that the metric (and thus the generated elements) can be arbitrarily stretched.

- <b>Remove tiny edges</b> - if checked, the tiny (nano) edges are removed from the generated mesh.
The tiny edge value defines the minimal length under which an edge is considered to be a tiny one.

- <b>Remove bad elements</b> - if checked, the bad elements (slivers) are removed from the generated mesh.
The bad element value defines the aspect ratio triggering the "bad element” classification.

- <b>Mesh optimisation</b> - if checked, the mesh will be optimized in order to get better shaped elements.

- <b>Allow Quadrangles</b> - if checked, allows the creation of quadrilateral elements.

\ref blsurf_top "Back to top"

\section blsurf_advanced_parameters Advanced parameters

The notion of <i>diag</i> used in the descriptions means the diagonal of the bounding box of the geometrical object to mesh.

\image html blsurf_parameters_advanced.png

- <b>CAD preprocessor options</b>. The CAD preprocessor (formerly known as PreCAD) has two main goals:

  - Complete missing or inadequate CAD descriptions.

  - Perform topology reconstruction and specific geometry
  enhancement for mesh generation.

  \n The following preprocessor options are the most significant and important ones.
  All options are unchecked by default. No cleanup is made by default so that the mesh matches the shape.
  If the user has a bad shape (e.g. imported shape), he can activate some options to improve the mesh.

    - <b>Merge Edges</b> - optimize the geometry by merging some
    edges. This option is unchecked by default.

    - <b>Remove tiny UV edges</b> - optimize the geometry by removing small
    tiny edges on the UV face. This option is unchecked by default.

    - <b>Process 3D topology</b> - perform the cleanup processing.
    This option is unchecked by default.

    - <b>Discard input topology</b> - compute the CAD topology from scratch,
    without considering the topological information contained in the original CAD
    (useful for iges files). This option is unchecked by default.

    - <b>Remove duplicate CAD faces</b> - optimize the geometry by merging the
    duplicate CAD faces. This option is unchecked by default.

- <b>Verbosity level</b> - defines the percentage of "verbosity" of
MeshGems-CADSurf [0-10].

- <b>ExportGMF</b> - saves the computed mesh into a GMF file (.mesh or .meshb).

- <b>Add option</b> - provides the choice of multiple PreCAD and MG-CADSurf 
advanced options, which appear, if selected, in a table where it is 
possible to input the value of the option and edit it later.

- <b>Clear option</b> - removes the option selected in the table.

The following advanced MG-CADSurf options can be used:

- \b volume_gradation (real) - Controls the mesh volume gradation, which can improve the shape quality of a
volume mesh built afterward, specially in thin volume areas.
The volume gradation parameter must be greater than 1, and should be greater or equal to the value of the classic
surface gradation (at the risk of increasing the time of convergence of the gradation process).
The closer it is to 1, the smoother the final volume mesh you will build should be.

- \b correct_surface_intersections (bool) - If this option is deactivated, MeshGems-CADSurf will not correct
surface intersections. This particularly useful if you don't want volume filling in a later stage, or if you want to fix the
intersections in an other way (using MeshGems Cleaner for instance).
By default this option is 1.

- \b surface_intersections_processing_max_cost (real) - If correct_surface_intersections = 1, this
parameter gives the time the user is ready to spend in the intersection prevention process. For example,
if set to 3, MeshGems-CADSurf will not spend more time in the intersection removal process than
3 times the time required to mesh without processing the intersections.

- \b create_tag_on_collision (bool) - If this option is activated, MeshGems-CADSurf will create new tags to
describe tag collisions (when it locally changes the topology, depending on the patch independent
options). When this option is not activated, only one tag is preserved while the other one is dropped.
By default this option is 1.

- \b debug (bool) - If debug = 1, MeshGems-CADSurf will be very verbose and will output some intermediate files
in the working directory. This option is meant to communicate with Distene support mainly.
By default this option is 0.

- \b enforce_cad_edge_sizes (bool) - Relaxes the given sizemap constraint around CAD edges to allow a better
element quality and a better geometric approximation. It is only useful in combination with the gradation option.
By default this option is 0.

- \b rectify_jacobian (bool) - The quadratic elements generation is a processing of the MeshGems-CADSurf
meshing process which inserts the extra nodes on the CAD. This parameter determines whether
MeshGems-CADSurf will try to correct or not all the elements of the surface mesh with negative
Jacobians by moving the internal nodes of the mesh.
By default this option is 1.

- \b jacobian_rectification_respect_geometry (bool) - This parameter determines whether or not the geometry accuracy
is more important than the negative Jacobian correction. When this parameter is set to 0,
MeshGems-CADSurf is allowed to lose the CAD-mesh associativity in order to correct the last negative Jacobians.
By default this option is 1.

- \b respect_geometry (bool) - This patch independent option can be deactivated to allow MeshGems-CADSurf
to lower the geometry accuracy in its patch independent process.
By default this option is 1.

- \b optimise_tiny_edges (bool) - This patch-independent correction option can be activated to remove the tiny
edges (defined by the option tiny edge optimisation length) from the generated mesh when it improves
the local mesh quality, without taking into account the tags (attributes) specifications.
By default this option is 0.

- \b tiny_edge_avoid_surface_intersections (bool) - This option defines the priority between the tiny feature
suppression and the surface intersection prevention. By default, MeshGems-CADSurf gives the priority
to the surface intersection prevention rather than to tiny edge or bad surface element removal. These
mesh features are then removed only if it does not lead to surface intersections. This behaviour can be
deactivated by setting this parameter to 0, giving priority to the tiny edge or bad surface element
removal.
By default this option is 1.

- \b tiny_edge_optimisation_length (double) - This parameter defines the minimal length under which an edge is
considered to be a tiny one to be optimised out by the optimise tiny edges option.
By default this option is \f$\mathrm{diag} \times 10^{-6}\f$.

- \b tiny_edge_respect_geometry (bool) - This option defines the behaviour of the tiny edge removal algorithm
regarding volume collapse. By default, all tiny edges will be removed, regardless of any potential
volume collapse. When this option is activated, it will prevent volume from being collapsed during the
tiny edge removal process.
By default this option is 0.

- \b max_number_of_points_per_patch (int) - This parameter controls the maximum amount of points MeshGems-CADSurf
is allowed to generate on a single CAD patch. For an automatic gestion of the memory, one can set this parameter to ”0”.
By default this option is 100000.

- \b periodic_tolerance (double) - This parameter defines the maximum size difference between two periodic edges
and also the maximum distance error between two periodic entities.
By default this option is diag/100.

- \b required_entities (char) - The required entities control the correction operations. Accepted values for this parameter are:

    - respect : MeshGems-CADSurf is not allowed to alter any required entity, even for correction purposes,
    - ignore : MeshGems-CADSurf will ignore the required entities in its processing,
    - clear : MeshGems-CADSurf will clear any required status for the entities. There will not be any entity marked as required in the generated mesh.

    \n By default this option is "respect".

- \b tags (char) - The tag (attribute) system controls the optimisation process. Accepted values for this parameter are:

    - respect : the CAD tags will be preserved and unaltered by the optimisation operations,
    - ignore : the CAD tags will be ignored by the optimisation operations but they will still be present inthe output mesh,
    - clear : MeshGems-CADSurf will clear any tag on any entity and optimise accordingly. There will not be any tag in the generated mesh.

    \n By default this option is "respect".

    
\b Remark: To set boolean options, you have to type 0 or 1.



The following MG-CADSurf options are deprecated (since MeshGems 1.3) and will be removed in the next version of Salome:

- frontal
- hinterpol_flag
- hmean_flag
- prox_nb_layer
- prox_ratio
- proximity.


The following PreCAD options are commonly usable. 

- \b closed_geometry (boolean) - describes whether the working geometry
should be closed or not. When activated, this option helps PreCAD to process 
the dirtiest geometries. By default this option is 0.

- \b create_tag_collision (boolean) - creates new tags from original ones in case
of collision (entity merge or association for example). By default
this option is 1.

- \b debug (bool) - If debug = 1 PreCAD will be very verbose and will output
some intermediate files in the working directory. By default this
option is 0.

- \b manifold_geometry (int) - describes whether the working geometry should be manifold or not.
When activated, this option helps PreCAD to process the dirtiest
geometries. By default this option is 0.

- \b periodic_tolerance (real) - defines the maximum distance error accepted between
two sets of periodic entities. By default this option is \f$\mathrm{diag} \times 10^{-5}\f$.

- \b remove_tiny_edges (boolean) -optimize the geometry by removing the nano edges whenever possible.
By default this option is 0.

- \b required_entities (char) -controls the correction operations. Possible values are:

  - "respect" - PreCAD is not allowed to correct or optimize a required edge.

  - "ignore" - PreCAD is allowed to correct a required edge.

  - "clear" - PreCAD will erase "required" status of each required entities, and will thus
  be allowed to correct a required edge.

  \n By default this option is "respect".

- \b sewing_tolerance (real) - tolerance of the assembly. It rarely requires to be tuned.
By default this option is \f$\mathrm{diag} \times 5 \cdot 10^{-4}\f$.

- \b tags (char) -controls the optimisation process. Possible values are:

  - "respect" - PreCAD is not allowed to cross the CAD attributes boundaries for optimisation purpose.

  - "ignore" - PreCAD is allowed to cross the CAD attributes boundaries for optimisation.

  - "clear" - PreCAD will erase each tgas of each entities, and will thus
  be allowed to cross the CAD attributes boundaries in its optimisation purpose.

  \n By default this option is "respect".

- \b tiny_edge_length (real) -  the length below which en edge is considered as nano for the topology processing.
By default this option is \f$10^{-5}\f$.

\note Moreover, user can choose "<Other option>" item in these two pop-up menus 
(MG-CADSurf and PreCAD) to be able to specify both the option name and the option value. 

\ref blsurf_top "Back to top"

\section blsurf_local_size Local size

Local sizes can be defined on faces, edges or vertices:

- The faces, edges and vertices can belong to the meshed geometrical
object or to its sub-shapes (created using <b>Explode</b> command).

- Groups of faces, edges and vertices are also handled.

- It is possible to attribute the same size to several geometries using multi-selection.

- The sizes are constant values or python functions.

- In case of a python function, the following rules must be respected:

  - The name of the function is f.

  - If geometry is a face or a group of faces, the function is f(u,v).

  - If geometry is an edge or a group of edges, the function is f(t).

  - If geometry is a vertex or a group of vertices, the function is f().

  - The function must return a double.

3 different types of size maps can be defined:

-# \ref blsurf_sizemap_computation "Computation of the physical size"
-# \ref blsurf_attractor "Advanced maps"
-# \ref blsurf_attractor_computation "Computation of attractors"

\ref blsurf_top "Back to top"

\subsection blsurf_sizemap_computation Computation of the physical size

\image html blsurf_parameters_sizemap1.png 

The physical size is obtained by querying sizemap functions associated
to the input CAD object for surfaces, curves and points.
Each function can either return a value h (which is then trimmed
between the two bounds hphymin and hphymax), or "no answer" (by not
assigning a value to h), thus providing great flexibility in the
specification of the sizes. The computation depends on whether point P
is internal to a surface, internal to a curve, or at the end of
several curves:

- If point P is internal to a surface, the CAD surface size function
is queried. If no answer is returned, one interpolates with the values
at the vertices of the discretized interface curves.

- If point P is internal to a curve, the CAD curve size function is
queried first. If no answer is returned, the surface size function is
queried for every adjacent surface and the mean value of the returned
values is computed. If no answer is returned, sizes h1 and h2 at both
ends of the curve are considered (see next item) and the interpolated
value is computed.

- If point P is at the extremity of several curves, the CAD point size
function is queried first. If no answer is returned, the curve size
function is queried for every adjacent curve and the mean value of the
returned values is computed. If no answer is returned, the surface
size function is queried for every adjacent surface and the mean value
of the returned values is computed. If there is still no answer
returned, the default value hphydef is kept.

In order to compute the mean of several values, the arithmetic mean is
used by default, but this can be modified by the parameter
\ref blsurf_hmean_flag "hmean flag". In the same way, in order to
interpolate two values, a linear interpolation is used by default, but
this can be modified by \ref blsurf_hinterpol_flag "hinterpol flag". 

\ref blsurf_local_size "Back to \"Local size\""\n
\ref blsurf_top "Back to top"

\subsection blsurf_attractor Advanced maps

\image html blsurf_parameters_sizemap2.png 

More specific size maps can be defined on faces. 

- <i> Attractors </i> allow to define the size of the mesh elements
on a face so that the mesh is the finest on the attractor shape and
becomes coarser when getting far from this shape.

  - The selected attractor can be a Vertex, an Edge, a Wire or a
  Compound mixing several entities of those types.

  - The attractor doesn't have to be a sub-shape of the shape to mesh.

  - The size will grow exponentially (see the formula below) but is
  bounded by gradation, \n so if you want the formula to be strictly
  respected, you should set the <i>gradation</i> 
  to its maximum (2.5) in the <i>arguments</i> tab. 

- Furthermore you can choose to <i> keep the size constant </i>
until a certain distance from a shape. This option can be combined or
not with an <i>attractor</i> size map described above. 

  - If the two options are combined the size will remain constant
  until the distance specified in "constant over" and grow then as
  prescribed by the attractor function.

  - Else the growing is only controled by the standard arguments of
  MG-CADSurf (gradation ...).

\image html blsurf_const_size_near_shape2.png "Example of size map with constant size option, the size is kept constant on the left side of the surface until a certain distance"

\note The validation of the hypothesis might take a few seconds if
attractors are defined or the "constant size" option is used because a
map of distances has to be built on the whole surface for each face
where such a hypothesis has been defined.

\sa Sample TUI Script of the \ref tui_blsurf "creation of a MG-CADSurf hypothesis", including size map.

\ref blsurf_local_size "Back to \"Local size\""\n
\ref blsurf_top "Back to top"

\subsection blsurf_attractor_computation Computation of attractors

The size grows exponentially following the equation : 
\f$h(d) = \mathrm{User Size} + (\mathrm{h\_start} - \mathrm{User Size}) \times e ^ { - \left( \frac{d}{R} \right) ^ {2} }\f$

Where :

- h_start is the desired size on the given attractor shape

- d is the distance of the current point from the attractor
shape. The distance is the geodesic distance (i.e. calculated by following the surface to be meshed)

- R is called the distance of influence and allows controlling the growth rate of the mesh

\image html blsurf_attractors2.png "Example of mesh created using attractors, the attractors here are the side edges and the size grows from the side of the surface towards the apex"

\ref blsurf_local_size "Back to \"Local size\""\n
\ref blsurf_top "Back to top"

\section blsurf_enforced_elements Enforced vertices

\image html blsurf_parameters_enforced_vertices.png

It is possible to define some enforced vertices to MG-CADSurf algorithm.
An enforced vertex is defined on a Face or a Compound by

- selecting an existing Vertex or Compound,

- or creating a new vertex given its coordinates.

The enforced vertex is the projection of a point defined by its
(x,y,z) coordinates on the selected face.

- It is possible to define several enforced vertices on a face or a group of faces.

- If the projected point is on the boundary or outside of the face, it will be ignored.

- If a group name is specified : If the group exists, the enforced nodes will be added in the existing group, if the group does not exist it will be created.

All the internal vertices of the faces can be considered as enforced vertices if the corresponding checkbox is checked.
A group can optionnaly be defined on those enforced vertices.

\sa Sample TUI Script of the \ref tui_blsurf "creation of a MG-CADSurf hypothesis", including enforced vertices.

\ref blsurf_top "Back to top"


\section blsurf_periodicity Periodicity

\subsection periodicity_introduction Introduction

Periodicity is used to have the same discretization on two faces (in 3D) or two edges (in 2D).
This is useful for instance for a Representative Volume Element so that the translated meshes share the same nodes on the common faces.

Periodicity association uses PreCAD (MG-CADSurf preprocessor). You don't need an extra PreCAD license. It is included in MG-CADSurf since MeshGems V2.2.

\image html blsurf_periodicity_translation.png "Two periodic faces (translation)"

\image html blsurf_periodicity_reflexion.png "Two periodic faces (reflexion)"

\image html blsurf_periodicity_2D.png "Associations of edges in 2D (both red edges are associated with each other)"

\subsection periodicity_gui_usage GUI usage

\image html blsurf_parameters_periodicity.png

The periodicity association can be defined:

- on 2 groups of faces (in 3D)
- on 2 groups of edges (in 2D)

If the transformation is a translation, PreCAD makes the periodicity association with only this information.

Otherwise, for instance a rotation, the user has to define 3 non-colinear vertices and their image by the transformation.

\subsection periodicity_tui_precad_usage TUI PreCAD usage

The two methods to define periodicity with PreCAD are
(the former name of <em>MG-CADSurf</em> is \a BLSURF and names
of the corresponding classes and modules still include \a "BLSURF"):
- BLSURFPluginBuilder.BLSURF_Algorithm.AddPreCadFacesPeriodicity
- BLSURFPluginBuilder.BLSURF_Algorithm.AddPreCadEdgesPeriodicity

List of source and target vertices to define a transformation are optional.

\sa Sample TUI Script of the definition of MG-CADSurf periodicity \ref tui_blsurf_periodicity_preCAD "using preCAD".

\ref blsurf_top "Back to top"

For more information on MeshGems-CADSurf, you can read its documentation at $MESHGEMS_ROOT_DIR/Docs/mg-cadsurf_user_manual.pdf

*/
